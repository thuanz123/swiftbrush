<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="bootstrap.min.css" rel="stylesheet" />

    <link rel="shortcut icon" href="images/brush.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="styles.css" />

    <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=P7mK86-USn-txT7Xmp7mIhP8PdmcdrMCFeCqUWeH25UxSo1vU2VjEv6Z4r4G0TqGaGBT4PW3J9GSQYC5Hj-m2Q" charset="UTF-8"></script><link rel="stylesheet" crossorigin="anonymous" href="https://gc.kis.v2.scr.kaspersky-labs.com/E3E8934C-235A-4B0E-825A-35A08381A191/abn/main.css?attr=aHR0cHM6Ly9pbWFnZW4ucmVzZWFyY2guZ29vZ2xlLw"/><script src="jquery.min.js"></script>
    <script src="jquery.flip.min.js"></script>

    <script src="chart.min.js"></script>

    <title>SwiftBrush</title>
  </head>
  <body>
    <div class="demo">
      <div class="terminal">
        <p id="terminal"></p>
      </div>
      <div class="container">
        <div class="dummy">
          <div class="terminalflipcard" id="terminalflipcard">
            <div class="front">
            </div>
            <div class="back">
              <img id="terminal_image"></img>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div style="padding-top: 50px; padding-bottom: 50px; background-color: rgb(0, 0, 0);">
      <h1 style="text-align: center;">SwiftBrush</h1>
      <h2 class="nomobile" style="text-align: center;">One-Step Text-to-Image Diffusion Model</h2>
      <h2 class="nomobile" style="text-align: center;">with Variational Score Distillation</h2>
      <h2 class="mobileonly" style="text-align: center;">One-Step Text-to-Image Diffusion Model</h2>
      <h2 class="mobileonly" style="text-align: center;">with Variational Score Distillation</h2>
    </div>

    <div style="padding-top: 50px; padding-bottom: 50px;">
      <h2 class="nomobile" style="text-align: center;">
        <a class="hover-underline-animation-blue" href="https://thuanz123.github.io"
        style="color: #ffffff; text-decoration: none;">Thuan Hoang Nguyen</a>&nbsp; &nbsp;
        <a class="hover-underline-animation-blue" href="https://scholar.google.com/citations?user=FYZ5ODQAAAAJ&hl=en"
        style="color: #ffffff; text-decoration: none;">Anh Tuan Tran</a>
      </h2>
      <h2 class="mobileonly" style="text-align: center;">
        <a class="hover-underline-animation-blue" href="https://thuanz123.github.io"
        style="color: #ffffff; text-decoration: none;">Thuan Hoang Nguyen</a>&nbsp; &nbsp;
        <a class="hover-underline-animation-blue" href="https://scholar.google.com/citations?user=FYZ5ODQAAAAJ&hl=en"
        style="color: #ffffff; text-decoration: none;">Anh Tuan Tran</a>
      </h2>
      <h2 class="nomobile" style="text-align: center;">VinAI Research</h2>
      <h2 class="mobileonly" style="text-align: center;">VinAI Research</h2>
    </div>

    <div class="abstract">
      <div class="inside">
        <p class="text">
          Despite their ability to generate high-resolution and diverse images from text prompts, text-to-image diffusion models often suffer from slow iterative sampling processes. Model distillation is one of the most effective directions to accelerate these models. However, previous distillation methods fail to retain the generation quality while requiring a significant amount of images for training, either from real data or synthetically generated by the teacher model. In response to this limitation, we present a novel image-free distillation scheme named <strong>SwiftBrush</strong>. Drawing inspiration from text-to-3D synthesis, in which a 3D neural radiance field that aligns with the input prompt can be obtained from a 2D text-to-image diffusion prior via a specialized loss without the use of any 3D data ground-truth, our approach re-purposes that same loss for distilling a pretrained multi-step text-to-image model to a student network that can generate high-fidelity images with just a single inference step. In spite of its simplicity, our model stands as one of the first one-step text-to-image generators that can produce images of comparable quality to Stable Diffusion without reliance on any training image data. Remarkably, SwiftBrush achieves an FID score of <strong>16.67</strong> and a CLIP score of <strong>0.29</strong> on the COCO-30K benchmark, achieving competitive results or even substantially surpassing existing state-of-the-art distillation techniques.
        </p>
        <a class="read-paper"  target="_blank" href="https://arxiv.org/abs/2312.05239"><button>Research Paper</button></a>
        <a class="read-paper" style="margin-left: 20px;" target="_blank" href="https://thuanz123.github.io/swiftbrush"><button>Github (TBD)</button></a>
      </div>
    </div>

    <div class="image_8" id="gallery0">
      <div class="flipcard" id="fig0">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/A hyperrealistic photo of fox astronaut, perfect face, artstation.png">
            <figcaption>A hyperrealistic photo of fox astronaut, perfect face, artstation</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/A hyperrealistic photo of fox astronaut, perfect face, artstation.png">
            <figcaption>A hyperrealistic photo of fox astronaut, perfect face, artstation</figcaption>
          </figure>
        </div>
      </div>
      <div class="flipcard" id="fig1">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/A DSLR photo of a dog wearing glasses at the beach.png">
            <figcaption>A DSLR photo of a dog wearing glasses at the beach</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/A DSLR photo of a dog wearing glasses at the beach.png">
            <figcaption>A DSLR photo of a dog wearing glasses at the beach</figcaption>
          </figure>
        </div>
      </div>
      <div class="flipcard nomobile" id="fig2">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/A high-resolution photograph of a waterfall in autumn; muted tone.png">
            <figcaption>A high-resolution photograph of a waterfall in autumn; muted tone</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/A high-resolution photograph of a waterfall in autumn; muted tone.png">
            <figcaption>A high-resolution photograph of a waterfall in autumn; muted tone</figcaption>
          </figure>
        </div>
      </div>
      <div class="flipcard nomobile" id="fig3">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/Portrait of a cat astronaut with Japanese samurai helmets.png">
            <figcaption>Portrait of a cat astronaut with Japanese samurai helmets</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/Portrait of a cat astronaut with Japanese samurai helmets.png">
            <figcaption>Portrait of a cat astronaut with Japanese samurai helmets</figcaption>
          </figure>
        </div>
      </div>
      <div class="flipcard nomobile" id="fig4">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/A poodle wearing a baseball cap and holding a dictionary in hand.png">
            <figcaption>A poodle wearing a baseball cap and holding a dictionary in hand</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/A poodle wearing a baseball cap and holding a dictionary in hand.png">
            <figcaption>A poodle wearing a baseball cap and holding a dictionary in hand</figcaption>
          </figure>
        </div>
      </div>
      <div class="flipcard nomobile" id="fig5">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/An oil painting of a vase with yellow roses, style of Frank Auerbach.png">
            <figcaption>An oil painting of a vase with yellow roses, style of Frank Auerbach</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/An oil painting of a vase with yellow roses, style of Frank Auerbach.png">
            <figcaption>An oil painting of a vase with yellow roses, style of Frank Auerbach</figcaption>
          </figure>
        </div>
      </div>
      <div class="flipcard nomobile" id="fig6">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/A photo of one ice cream ball in a luxurious plate, bokeh.png">
            <figcaption>A photo of one ice cream ball in a luxurious plate, bokeh</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/A photo of one ice cream ball in a luxurious plate, bokeh.png">
            <figcaption>A photo of one ice cream ball in a luxurious plate, bokeh</figcaption>
          </figure>
        </div>
      </div>
      <div class="flipcard nomobile" id="fig7">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/A blue Porsche 356 parked in front of a brick wall.png">
            <figcaption>A blue Porsche 356 parked in front of a brick wall</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/A blue Porsche 356 parked in front of a brick wall.png">
            <figcaption>A blue Porsche 356 parked in front of a brick wall</figcaption>
          </figure>
        </div>
      </div>
    </div>

    <div class="content1">
      <div>
        <h1>SwiftBrush research highlights</h1>
        <ul class="highlights">
          <li>We show that large-scale text-image dataset are not really important for the one-step text-to-image distillation task.</li>
          <li>We show that by adapting techniques from text-to-3D synthesis task, it is possible to distill a multi-step text-to-image diffusion models into one-step generators.</li>
          <li>We introduce a new distillation method for text-to-image diffusion models, which enables the single-step generation of high-quality images from text prompts.</li>
          <li>We achieve a new state-of-the-art on several benchmarks; and human raters find SwiftBrush samples to be better than InstaFlow in terms of image quality and image-text alignment.</li>
        </ul>
      </div>
      <div class="right" style="display: flex;">
        <table class="pretty" style="align-self: center;">
          <caption>Qualitative comparison of our work against exsiting distillation methods on COCO 2014.</caption>
          <tr style="border-bottom: 3px solid rgb(26, 26, 26);">
            <th>Model</th><th class="fid">FID &darr;</th><th class="clip">CLIP &uarr;</th>
          </tr>
          <tr>
            <td>Image-depedent</td>
          </tr>
          <tr>
            <td class="model">Guided Distillation (Meng et al., 2023)</td><td class="fid">37.3</td><td class="clip">0.27</td>
          </tr>
          <tr>
            <td class="model">LCM (Luo et al., 2023)</td><td class="fid">35.56</td><td class="clip">0.24</td>
          </tr>
          <tr>
            <td class="model">InstaFlow (Liu et al., 2023)</td><td class="fid" style="font-weight: bold; color: rgb(26, 26, 26);">13.27</td><td class="clip"><u>0.28</u></td>
          </tr>
          <tr style="border-top: 1px solid rgb(26, 26, 26);">
            <td>Image-free</td>
          </tr>
          <tr>
            <td class="model">BOOT (Gu et al., 2023)</td><td class="fid">17.89</td><td class="clip">35.49</td>
          </tr>
          <tr style="border-bottom: 3px solid rgb(26, 26, 26);">
            <td class="model" style="font-weight: bold; color: rgb(26, 26, 26);">SwiftBrush (Our Work)</td><td class="fid"><u>16.67</u></td><td class="clip" style="font-weight: bold; color: rgb(26, 26, 26);">0.29</td>
          </tr>
          <tr style="border-top: 1px solid rgb(26, 26, 26);">
            <td>Stable Diffusion v2.1</td>
          </tr>
          <tr>
            <td class="model">1 sampling step</td><td class="fid">13.45</td><td class="clip">0.23</td>
          </tr>
          <tr>
            <td class="model">25 sampling steps</td><td class="fid">202.14</td><td class="clip">0.06</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="compositional">
      <div class="image">
        <img src="" id="compositional_animals_img">
      </div>
      <div class="text" id="compositional_animals">
        <h3>Click on a word below and brush swiftly!</h3>
        <p class="selectable left"><span class="selected">A DSLR photo of a</span> <span>An oil painting of a</span><p>
        <p class="selectable left"><span>panda</span> <span class="selected">owl</span> <span>cat</span> <span>shiba inu</span> <span>raccoon</span><p>
        <p class="selectable left"><span>drinking latte</span> <span class="selected">eating pizza</span></p>
        <p class="selectable left"><span>in a garden</span> <span class="selected">on a beach</span> <span>on top of a mountain</span></p>
      </div>
    </div>

    <div class="header_dark_gray">
      <h1>SwiftBrush</h1>
      <h2>speedy &middot; simple &middot; sublime</h2>
    </div>

    <div class="image_8" id="gallery1" style="background-color: rgb(26, 26, 26);">
      <div class="flipcard" id="fig0">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/A high-resolution photo of a persian cat wearing a sunglasses and a beach hat in Times Square.png">
            <figcaption>A high-resolution photo of a persian cat wearing a sunglasses and a beach hat in Times Square</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/A high-resolution photo of a persian cat wearing a sunglasses and a beach hat in Times Square.png">
            <figcaption>A high-resolution photo of a persian cat wearing a sunglasses and a beach hat in Times Square</figcaption>
          </figure>
        </div>
      </div>
      <div class="flipcard nomobile" id="fig1">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/A pencil sketch of an old man by Milt Kahl.png">
            <figcaption>A pencil sketch of an old man by Milt Kahl</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/A pencil sketch of an old man by Milt Kahl.png">
            <figcaption>A pencil sketch of an old man by Milt Kahl</figcaption>
          </figure>
        </div>
      </div>
      <div class="flipcard nomobile" id="fig2">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/A majestic oil painting of a raccoon Queen wearing red French royal gown.png">
            <figcaption>A majestic oil painting of a raccoon Queen wearing red French royal gown</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/A majestic oil painting of a raccoon Queen wearing red French royal gown">
            <figcaption>A majestic oil painting of a raccoon Queen wearing red French royal gown</figcaption>
          </figure>
        </div>
      </div>
      <div class="flipcard nomobile" id="fig3">
        <div class="front">
          <figure>
            <img src="./main_gallery_images/A dslr photo of a turtle sitting in a forest, fisheye lens view.png">
            <figcaption>A dslr photo of a turtle sitting in a forest, fisheye lens view</figcaption>
          </figure>
        </div>
        <div class="back">
          <figure>
            <img src="./main_gallery_images/A dslr photo of a turtle sitting in a forest, fisheye lens view.png">
            <figcaption>A dslr photo of a turtle sitting in a forest, fisheye lens view</figcaption>
          </figure>
        </div>
      </div>
    </div>

    <div class="content">
      <h1>Special Thanks</h1>
      <p class="smaller" style="text-align: justify;">We give thanks to Uy Dieu Tran for early discussions as well as providing many helpful comments and suggestions throughout the project. Special thanks to Trung Tuan Dao for valuable feedback and support. Last but not least, we thank Zhengyi Wang, Cheng Lu, Yikai Wang, Fan Bao, Chongxuan Li, Hang Su and Jun Zhu for the work of ProlificDreamer as well as Huggingface team for the diffusers framework.</p>
    </div>

    <script type="text/javascript">
      images = [
        {
          "src": "./main_gallery_images/A hyperrealistic photo of fox astronaut, perfect face, artstation.png",
          "caption": "A hyperrealistic photo of fox astronaut, perfect face, artstation",
        },
        {
          "src": "./main_gallery_images/A monkey wearing a suit.png",
          "caption": "A monkey wearing a suit",
        },
        {
          "src": "./main_gallery_images/A high-resolution photograph of a waterfall in autumn; muted tone.png",
          "caption": "A high-resolution photograph of a waterfall in autumn; muted tone",
        },
        {
          "src": "./main_gallery_images/Photo of a beach when sun is setting at the horizon line.png",
          "caption": "Photo of a beach when sun is setting at the horizon line",
        },
        {
          "src": "./main_gallery_images/A poodle wearing a baseball cap and holding a dictionary in hand.png",
          "caption": "A poodle wearing a baseball cap and holding a dictionary in hand",
        },
        {
          "src": "./main_gallery_images/A dslr photo of a turtle sitting in a forest, fisheye lens view.png",
          "caption": "A dslr photo of a turtle sitting in a forest, fisheye lens view",
        },
        {
          "src": "./main_gallery_images/A DSLR photo of a dog wearing glasses at the beach.png",
          "caption": "A DSLR photo of a dog wearing glasses at the beach",
        },
        {
          "src": "./main_gallery_images/Portrait of a cat astronaut with Japanese samurai helmets.png",
          "caption": "Portrait of a cat astronaut with Japanese samurai helmets",
        },
        {
          "src": "./main_gallery_images/A majestic oil painting of a raccoon Queen wearing red French royal gown.png",
          "caption": "A majestic oil painting of a raccoon Queen wearing red French royal gown"
        },
        {
          "src": "./main_gallery_images/A poodle wearing a baseball cap and holding a dictionary in hand.png",
          "caption": "A poodle wearing a baseball cap and holding a dictionary in hand",
        },
        {
          "src": "./main_gallery_images/A DSLR photo of a dog wearing glasses at the beach.png",
          "caption": "A DSLR photo of a dog wearing glasses at the beach",
        },
        {
          "src": "./main_gallery_images/A photo of one ice cream ball in a luxurious plate, bokeh.png",
          "caption": "A photo of one ice cream ball in a luxurious plate, bokeh",
        },
        {
          "src": "./main_gallery_images/A blue Porsche 356 parked in front of a brick wall.png",
          "caption": "A blue Porsche 356 parked in front of a brick wall",
        },        
        {
          "src": "./main_gallery_images/A cozy, sunlit reading nook with a comfortable armchair, a small wooden side table, and a stack of books.png",
          "caption": "A cozy, sunlit reading nook with a comfortable armchair, a small wooden side table, and a stack of books",
        },
        {
          "src": "./main_gallery_images/A small cactus growing in a teacup.png",
          "caption": "A small cactus growing in a teacup",
        },
        {
          "src": "./main_gallery_images/A small, whimsical tree growing in the middle of a cupcake, with branches bearing miniature fruits.png",
          "caption": "A small, whimsical tree growing in the middle of a cupcake, with branches bearing miniature fruits",
        },
        {
          "src": "./main_gallery_images/A pencil sketch of an old man by Milt Kahl.png",
          "caption": "A pencil sketch of an old man by Milt Kahl",
        },
        {
          "src": "./main_gallery_images/A high-resolution photo of a persian cat wearing a sunglasses and a beach hat in Times Square.png",
          "caption": "A high-resolution photo of a persian cat wearing a sunglasses and a beach hat in Times Square",
        },
        {
          "src": "./main_gallery_images/A rolls royce phantom on the road. Oil painting of cuno amiet, 8k wallpaper.png",
          "caption": "A rolls royce phantom on the road. Oil painting of cuno amiet, 8k wallpaper",
        },
        {
          "src": "./main_gallery_images/A river running through a forest.png",
          "caption": "A river running through a forest",
        },
      ];

      lastCardFlippedIdx = {
        gallery0: -1,
        gallery1: -1,
      };

      lastCardFlippedLastSwapTime = {
        gallery0: -1,
        gallery1: -1,
      };

      function checkIfImageIsVisible(name, image) {
        numCards = $(name + " .flipcard:visible").size();

        for (var cardIdx = 0; cardIdx < numCards; ++cardIdx) {
          var isFlipped = $(name + " #fig" + cardIdx).data("flip-model").isFlipped;
          if (!isFlipped) {
            src = $(name + " #fig" + cardIdx + " div.front figure img").attr("src")
          } else {
            src = $(name + " #fig" + cardIdx + " div.back figure img").attr("src")
          }

          if (image.src == src) {
            return true;
          }
        }
        return false;
      }

      function getNextImage(name) {
        while (true) {
          randomImageIdx = Math.floor(Math.random() * images.length);
          if (!checkIfImageIsVisible(name, images[randomImageIdx])) {
            return images[randomImageIdx];
          }
        }
      }

      function randomSwapImageWithId(name, randomCardIdx) {
        numCards = $(name + " .flipcard:visible").size();

        image = getNextImage(name);

        const d = new Date();
        let currentTime = d.getTime();
        lastCardFlippedIdx[name] = randomCardIdx;
        lastCardFlippedLastSwapTime[name] = currentTime;

        var isFlipped = $(name + " #fig" + randomCardIdx).data("flip-model").isFlipped;
        if (!isFlipped) {
          $(name + " #fig" + randomCardIdx + " div.back figure img").attr("src", image.src)
          $(name + " #fig" + randomCardIdx + " div.back figure figcaption").text(image.caption)
        } else {
          $(name + " #fig" + randomCardIdx + " div.front figure img").attr("src", image.src)
          $(name + " #fig" + randomCardIdx + " div.front figure figcaption").text(image.caption)
        }

        $(name + " #fig" + randomCardIdx).flip("toggle");
      }

      function randomSwapImage(name) {
        numCards = $(name + " .flipcard:visible").size();

        const d = new Date();
        if (d.getTime() - lastCardFlippedIdx[name] < 5000) {
          setTimeout(randomSwapImage, 1000, name);
          return;
        }

        do {
          randomCardIdx = Math.floor(Math.random() * numCards);
          if (numCards == 1) {
            break;
          }
        } while (randomCardIdx == lastCardFlippedIdx[name]);

        randomSwapImageWithId(name, randomCardIdx);
        setTimeout(randomSwapImage, 6000, name);
      }
      setTimeout(randomSwapImage, 6000, "#gallery0");
      setTimeout(randomSwapImage, 7000, "#gallery1");

      $("#gallery0 #fig0").click(
        function() {
          randomSwapImageWithId("#gallery0", 0);
        }
      );
      $("#gallery0 #fig1").click(
        function() {
          randomSwapImageWithId("#gallery0", 1);
        }
      );
      $("#gallery0 #fig2").click(
        function() {
          randomSwapImageWithId("#gallery0", 2);
        }
      );
      $("#gallery0 #fig3").click(
        function() {
          randomSwapImageWithId("#gallery0", 3);
        }
      );
      $("#gallery0 #fig4").click(
        function() {
          randomSwapImageWithId("#gallery0", 4);
        }
      );
      $("#gallery0 #fig5").click(
        function() {
          randomSwapImageWithId("#gallery0", 5);
        }
      );
      $("#gallery0 #fig6").click(
        function() {
          randomSwapImageWithId("#gallery0", 6);
        }
      );
      $("#gallery0 #fig7").click(
        function() {
          randomSwapImageWithId("#gallery0", 7);
        }
      );

      $("#gallery1 #fig0").click(
        function() {
          randomSwapImageWithId("#gallery1", 0);
        }
      );
      $("#gallery1 #fig1").click(
        function() {
          randomSwapImageWithId("#gallery1", 1);
        }
      );
      $("#gallery1 #fig2").click(
        function() {
          randomSwapImageWithId("#gallery1", 2);
        }
      );
      $("#gallery1 #fig3").click(
        function() {
          randomSwapImageWithId("#gallery1", 3);
        }
      );
    </script>

    <script type="text/javascript">
      function resetTerminalText() {
        $("#terminal").html("");
      }

      function resetTerminal() {
        $("#terminalflipcard").flip(false);
        setTimeout(resetTerminalText, 250);
      }

      function typeTerminal(image) {
        terminalTextIdx = 0;
        (function typeChar() {
          html = "<span class=\"typed\">";
          html += image.caption.slice(0, ++terminalTextIdx);
          html += "</span><span class=\"soon\">";
          html += image.caption.slice(terminalTextIdx, image.caption.length);
          html += "<span>";

          $("#terminal").html(html);
          if (terminalTextIdx < image.caption.length) {
            setTimeout(typeChar, 20);
          } else {
            function displayImage() {
              $("#terminal_image").attr("src", image.src);
              $("#terminalflipcard").flip(true);
            }

            setTimeout(displayImage, 100);
            setTimeout(resetTerminal, 5000);
            setTimeout(randomNextTerminal, 6500);
          }
        })();
      }

      function randomNextTerminal() {
        randomImageIdx = Math.floor(Math.random() * images.length);
        image = images[randomImageIdx];

        typeTerminal(image);
      }

      setTimeout(randomNextTerminal, 1000);
      $(".flipcard").flip({
        trigger: "manual",
        reverse: false,
      });
      $("#terminalflipcard").flip({
        trigger: "manual",
        reverse: false,
        speed: 500
      });
    </script>

    <script type="text/javascript">
      compositionalAnimalsManualClicked = false;

      function updateComposition(name) {
        var compositionSpans = $(name + " p span.selected").map(function() {
          return $(this).text();
        }).get();
        var compositionText = "";
        for (var compositionSpansIdx = 0; compositionSpansIdx < compositionSpans.length; ++compositionSpansIdx) {
          if (compositionSpansIdx > 0) {
            compositionText += " ";
          }
          compositionText += compositionSpans[compositionSpansIdx];
        }
        if (name == "#compositional_animals") {
          $(name + "_img").attr("src", "./compositional/" + compositionText + ".png");
        }
      }

      function randomComposition(name) {
        if (name == "#compositional_animals" && compositionalAnimalsManualClicked == true) {
          compositionalAnimalsManualClicked = false;
          setTimeout(randomComposition, 4000, name);
          return;
        }

        var compositionPs = $(name + " p.selectable").toArray();
        var compositionOptions = [];
        for (var i = 0; i < compositionPs.length; ++i) {
          var compositionSpanSelected = $(compositionPs[i]).children("span.selected");
          var compositionSpans = $(compositionPs[i]).children("span").not("span.selected").toArray();
          for (var j = 0; j < compositionSpans.length; ++j) {
            compositionOption = {
              "p": compositionPs[i],
              "span_selected": compositionSpanSelected,
              "span_option": $(compositionSpans[j])
            };
            compositionOptions.push(compositionOption);
          }
        }

        randomCompositionOptionIdx = Math.floor(Math.random() * compositionOptions.length);
        randomCompositionOption = compositionOptions[randomCompositionOptionIdx];

        randomCompositionOption.span_selected.toggleClass("selected");
        randomCompositionOption.span_option.toggleClass("selected");

        updateComposition(name);
        setTimeout(randomComposition, 4000, name);
      }

      $("#compositional_animals p.selectable span").click(function() {
        $(this).siblings().removeClass("selected");
        $(this).addClass("selected");
        updateComposition("#compositional_animals");
        compositionalAnimalsManualClicked = true;
      });

      setTimeout(randomComposition, 2000, "#compositional_animals");
    </script>


    <script src="bootstrap.bundle.min.js"></script>
  </body>
</html>
